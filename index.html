<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>EXIF</title>
</head>
<body>
    <form enctype="multipart/form-data">
        <input name="file" type="file" />
        <input type="button" value="Upload" />
    </form>
    <p id="pic-info"></p>
    <p id="pic-info2"></p>

    <p id="pic-info1"></p>
    <p id="pic-info3"></p>

    <p id="map-link"></p>

    <script type="text/javascript" src="exif.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        
        $(':file').on('change', function () {
            var file = this.files[0];
            

            console.log(file);

            if (file.name.split('.')[1] === 'png' || file.name.split('.')[1] === 'PNG') {
                document.getElementById('pic-info1').innerHTML = 'We only support jpg files'
            } else {
                EXIF.getData(file, function() {

                    myData = file;

                    console.log(myData.exifdata);

                    // document.getElementById('pic-info1').innerHTML = JSON.stringify(myData.exifdata.GPSLatitude[2]);
                    // document.getElementById('pic-info2').innerHTML = JSON.stringify(myData.exifdata.GPSLatitudeRef);
                    // document.getElementById('pic-info3').innerHTML = JSON.stringify(myData.exifdata.GPSLongitude[2]);
                    // document.getElementById('pic-info3').innerHTML = JSON.stringify(myData.exifdata.GPSLongitudeRef);

                    // Calculate latitude decimal
                    var latDegree = myData.exifdata.GPSLatitude[0].numerator;
                    var latMinute = myData.exifdata.GPSLatitude[1].numerator;
                    var latSecond = myData.exifdata.GPSLatitude[2].numerator;
                    var latDirection = myData.exifdata.GPSLatitudeRef;

                    var latFinal = ConvertDMSToDD(latDegree, latMinute, latSecond, latDirection);


                    // Calculate longitude decimal
                    var lonDegree = myData.exifdata.GPSLongitude[0].numerator;
                    var lonMinute = myData.exifdata.GPSLongitude[1].numerator;
                    var lonSecond = myData.exifdata.GPSLongitude[2].numerator;
                    var lonDirection = myData.exifdata.GPSLongitudeRef;

                    var lonFinal = ConvertDMSToDD(lonDegree, lonMinute, lonSecond, lonDirection);

                    let lat = `${latDegree}째 ${latMinute}\' ${myData.exifdata.GPSLatitude[2]}\" ${latDirection}`;
                    let long = `${lonDegree}째 ${lonMinute}\' ${myData.exifdata.GPSLongitude[2]}\" ${lonDirection}`;

                    document.getElementById('pic-info').innerHTML = `Latitude: ${lat}`;
                    document.getElementById('pic-info2').innerHTML = `Longitude: ${long}`;
                    // 39째46'41.2"N+86째10'16.2"W
                    // document.getElementById('map-link').innerHTML = `<a href="http://www.google.com/maps/place/${test}+${test1}" target="_blank">Google Maps</a>`;

                    });
            }
        });


        function ConvertDMSToDD(degrees, minutes, seconds, direction) {
            
            var dd = degrees + (minutes/60) + (seconds/3600);
            
            if (direction === "S" || direction === "W") {
                dd = -Math.abs(dd); 
            }
            
            return dd;
        }

    </script>
</body>
</html>